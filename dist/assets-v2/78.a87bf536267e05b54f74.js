(self.webpackChunkwikistats=self.webpackChunkwikistats||[]).push([[78],{4547:(t,n,e)=>{"use strict";e.d(n,{LL:()=>f,y4:()=>p});var i=Array.prototype.slice;function o(t){return t}var a=1e-6;function r(t){return"translate("+(t+.5)+",0)"}function s(t){return"translate(0,"+(t+.5)+")"}function c(t){return function(n){return+t(n)}}function h(t){var n=Math.max(0,t.bandwidth()-1)/2;return t.round()&&(n=Math.round(n)),function(e){return+t(e)+n}}function u(){return!this.__axis}function l(t,n){var e=[],l=null,f=null,p=6,_=6,d=3,y=1===t||4===t?-1:1,v=4===t||2===t?"x":"y",x=1===t||3===t?r:s;function g(i){var r=null==l?n.ticks?n.ticks.apply(n,e):n.domain():l,s=null==f?n.tickFormat?n.tickFormat.apply(n,e):o:f,g=Math.max(p,0)+d,m=n.range(),b=+m[0]+.5,w=+m[m.length-1]+.5,k=(n.bandwidth?h:c)(n.copy()),M=i.selection?i.selection():i,j=M.selectAll(".domain").data([null]),N=M.selectAll(".tick").data(r,n).order(),S=N.exit(),T=N.enter().append("g").attr("class","tick"),A=N.select("line"),O=N.select("text");j=j.merge(j.enter().insert("path",".tick").attr("class","domain").attr("stroke","#000")),N=N.merge(T),A=A.merge(T.append("line").attr("stroke","#000").attr(v+"2",y*p)),O=O.merge(T.append("text").attr("fill","#000").attr(v,y*g).attr("dy",1===t?"0em":3===t?"0.71em":"0.32em")),i!==M&&(j=j.transition(i),N=N.transition(i),A=A.transition(i),O=O.transition(i),S=S.transition(i).attr("opacity",a).attr("transform",(function(t){return isFinite(t=k(t))?x(t):this.getAttribute("transform")})),T.attr("opacity",a).attr("transform",(function(t){var n=this.parentNode.__axis;return x(n&&isFinite(n=n(t))?n:k(t))}))),S.remove(),j.attr("d",4===t||2==t?"M"+y*_+","+b+"H0.5V"+w+"H"+y*_:"M"+b+","+y*_+"V0.5H"+w+"V"+y*_),N.attr("opacity",1).attr("transform",(function(t){return x(k(t))})),A.attr(v+"2",y*p),O.attr(v,y*g).text(s),M.filter(u).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",2===t?"start":4===t?"end":"middle"),M.each((function(){this.__axis=k}))}return g.scale=function(t){return arguments.length?(n=t,g):n},g.ticks=function(){return e=i.call(arguments),g},g.tickArguments=function(t){return arguments.length?(e=null==t?[]:i.call(t),g):e.slice()},g.tickValues=function(t){return arguments.length?(l=null==t?null:i.call(t),g):l&&l.slice()},g.tickFormat=function(t){return arguments.length?(f=t,g):f},g.tickSize=function(t){return arguments.length?(p=_=+t,g):p},g.tickSizeInner=function(t){return arguments.length?(p=+t,g):p},g.tickSizeOuter=function(t){return arguments.length?(_=+t,g):_},g.tickPadding=function(t){return arguments.length?(d=+t,g):d},g}function f(t){return l(3,t)}function p(t){return l(4,t)}},4818:(t,n,e)=>{"use strict";e.d(n,{Sf:()=>c});var i={},o={};function a(t){return new Function("d","return {"+t.map((function(t,n){return JSON.stringify(t)+": d["+n+"]"})).join(",")+"}")}function r(t){var n=new RegExp('["'+t+"\n\r]"),e=t.charCodeAt(0);function r(t,n){var a,r=[],s=t.length,c=0,h=0,u=s<=0,l=!1;function f(){if(u)return o;if(l)return l=!1,i;var n,a,r=c;if(34===t.charCodeAt(r)){for(;c++<s&&34!==t.charCodeAt(c)||34===t.charCodeAt(++c););return(n=c)>=s?u=!0:10===(a=t.charCodeAt(c++))?l=!0:13===a&&(l=!0,10===t.charCodeAt(c)&&++c),t.slice(r+1,n-1).replace(/""/g,'"')}for(;c<s;){if(10===(a=t.charCodeAt(n=c++)))l=!0;else if(13===a)l=!0,10===t.charCodeAt(c)&&++c;else if(a!==e)continue;return t.slice(r,n)}return u=!0,t.slice(r,s)}for(10===t.charCodeAt(s-1)&&--s,13===t.charCodeAt(s-1)&&--s;(a=f())!==o;){for(var p=[];a!==i&&a!==o;)p.push(a),a=f();n&&null==(p=n(p,h++))||r.push(p)}return r}function s(n){return n.map(c).join(t)}function c(t){return null==t?"":n.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t}return{parse:function(t,n){var e,i,o=r(t,(function(t,o){if(e)return e(t,o-1);i=t,e=n?function(t,n){var e=a(t);return function(i,o){return n(e(i),o,t)}}(t,n):a(t)}));return o.columns=i||[],o},parseRows:r,format:function(n,e){return null==e&&(e=function(t){var n=Object.create(null),e=[];return t.forEach((function(t){for(var i in t)i in n||e.push(n[i]=i)})),e}(n)),[e.map(c).join(t)].concat(n.map((function(n){return e.map((function(t){return c(n[t])})).join(t)}))).join("\n")},formatRows:function(t){return t.map(s).join("\n")}}}var s=r(","),c=(s.parse,s.parseRows,s.format),h=(s.formatRows,r("\t"));h.parse,h.parseRows,h.format,h.formatRows},8638:(t,n,e)=>{"use strict";e.d(n,{dQ:()=>ie,DE:()=>Qn,Bv:()=>Gn});var i="http://www.w3.org/1999/xhtml";const o={svg:"http://www.w3.org/2000/svg",xhtml:i,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function a(t){var n=t+="",e=n.indexOf(":");return e>=0&&"xmlns"!==(n=t.slice(0,e))&&(t=t.slice(e+1)),o.hasOwnProperty(n)?{space:o[n],local:t}:t}function r(t){return function(){var n=this.ownerDocument,e=this.namespaceURI;return e===i&&n.documentElement.namespaceURI===i?n.createElement(t):n.createElementNS(e,t)}}function s(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function c(t){var n=a(t);return(n.local?s:r)(n)}function h(){}function u(t){return null==t?h:function(){return this.querySelector(t)}}function l(){return[]}function f(t){return new Array(t.length)}function p(t,n){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=n}function _(t,n,e,i,o,a){for(var r,s=0,c=n.length,h=a.length;s<h;++s)(r=n[s])?(r.__data__=a[s],i[s]=r):e[s]=new p(t,a[s]);for(;s<c;++s)(r=n[s])&&(o[s]=r)}function d(t,n,e,i,o,a,r){var s,c,h,u={},l=n.length,f=a.length,_=new Array(l);for(s=0;s<l;++s)(c=n[s])&&(_[s]=h="$"+r.call(c,c.__data__,s,n),h in u?o[s]=c:u[h]=c);for(s=0;s<f;++s)(c=u[h="$"+r.call(t,a[s],s,a)])?(i[s]=c,c.__data__=a[s],u[h]=null):e[s]=new p(t,a[s]);for(s=0;s<l;++s)(c=n[s])&&u[_[s]]===c&&(o[s]=c)}function y(t,n){return t<n?-1:t>n?1:t>=n?0:NaN}function v(t){return function(){this.removeAttribute(t)}}function x(t){return function(){this.removeAttributeNS(t.space,t.local)}}function g(t,n){return function(){this.setAttribute(t,n)}}function m(t,n){return function(){this.setAttributeNS(t.space,t.local,n)}}function b(t,n){return function(){var e=n.apply(this,arguments);null==e?this.removeAttribute(t):this.setAttribute(t,e)}}function w(t,n){return function(){var e=n.apply(this,arguments);null==e?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,e)}}function k(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function M(t){return function(){this.style.removeProperty(t)}}function j(t,n,e){return function(){this.style.setProperty(t,n,e)}}function N(t,n,e){return function(){var i=n.apply(this,arguments);null==i?this.style.removeProperty(t):this.style.setProperty(t,i,e)}}function S(t,n){return t.style.getPropertyValue(n)||k(t).getComputedStyle(t,null).getPropertyValue(n)}function T(t){return function(){delete this[t]}}function A(t,n){return function(){this[t]=n}}function O(t,n){return function(){var e=n.apply(this,arguments);null==e?delete this[t]:this[t]=e}}function P(t){return t.trim().split(/^|\s+/)}function E(t){return t.classList||new C(t)}function C(t){this._node=t,this._names=P(t.getAttribute("class")||"")}function R(t,n){for(var e=E(t),i=-1,o=n.length;++i<o;)e.add(n[i])}function q(t,n){for(var e=E(t),i=-1,o=n.length;++i<o;)e.remove(n[i])}function B(t){return function(){R(this,t)}}function D(t){return function(){q(this,t)}}function I(t,n){return function(){(n.apply(this,arguments)?R:q)(this,t)}}function z(){this.textContent=""}function W(t){return function(){this.textContent=t}}function X(t){return function(){var n=t.apply(this,arguments);this.textContent=null==n?"":n}}function H(){this.innerHTML=""}function L(t){return function(){this.innerHTML=t}}function Y(t){return function(){var n=t.apply(this,arguments);this.innerHTML=null==n?"":n}}function V(){this.nextSibling&&this.parentNode.appendChild(this)}function F(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function U(){return null}function G(){var t=this.parentNode;t&&t.removeChild(this)}function J(){return this.parentNode.insertBefore(this.cloneNode(!1),this.nextSibling)}function $(){return this.parentNode.insertBefore(this.cloneNode(!0),this.nextSibling)}p.prototype={constructor:p,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,n){return this._parent.insertBefore(t,n)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}},C.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var n=this._names.indexOf(t);n>=0&&(this._names.splice(n,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var Q={},K=null;function Z(t,n,e){return t=tt(t,n,e),function(n){var e=n.relatedTarget;e&&(e===this||8&e.compareDocumentPosition(this))||t.call(this,n)}}function tt(t,n,e){return function(i){var o=K;K=i;try{t.call(this,this.__data__,n,e)}finally{K=o}}}function nt(t){return t.trim().split(/^|\s+/).map((function(t){var n="",e=t.indexOf(".");return e>=0&&(n=t.slice(e+1),t=t.slice(0,e)),{type:t,name:n}}))}function et(t){return function(){var n=this.__on;if(n){for(var e,i=0,o=-1,a=n.length;i<a;++i)e=n[i],t.type&&e.type!==t.type||e.name!==t.name?n[++o]=e:this.removeEventListener(e.type,e.listener,e.capture);++o?n.length=o:delete this.__on}}}function it(t,n,e){var i=Q.hasOwnProperty(t.type)?Z:tt;return function(o,a,r){var s,c=this.__on,h=i(n,a,r);if(c)for(var u=0,l=c.length;u<l;++u)if((s=c[u]).type===t.type&&s.name===t.name)return this.removeEventListener(s.type,s.listener,s.capture),this.addEventListener(s.type,s.listener=h,s.capture=e),void(s.value=n);this.addEventListener(t.type,h,e),s={type:t.type,name:t.name,value:n,listener:h,capture:e},c?c.push(s):this.__on=[s]}}function ot(t,n,e,i){var o=K;t.sourceEvent=K,K=t;try{return n.apply(e,i)}finally{K=o}}function at(t,n,e){var i=k(t),o=i.CustomEvent;"function"==typeof o?o=new o(n,e):(o=i.document.createEvent("Event"),e?(o.initEvent(n,e.bubbles,e.cancelable),o.detail=e.detail):o.initEvent(n,!1,!1)),t.dispatchEvent(o)}function rt(t,n){return function(){return at(this,t,n)}}function st(t,n){return function(){return at(this,t,n.apply(this,arguments))}}"undefined"!=typeof document&&("onmouseenter"in document.documentElement||(Q={mouseenter:"mouseover",mouseleave:"mouseout"}));var ct=[null];function ht(t,n){this._groups=t,this._parents=n}function ut(t){return"string"==typeof t?new ht([[document.querySelector(t)]],[document.documentElement]):new ht([[t]],ct)}ht.prototype=function(){return new ht([[document.documentElement]],ct)}.prototype={constructor:ht,select:function(t){"function"!=typeof t&&(t=u(t));for(var n=this._groups,e=n.length,i=new Array(e),o=0;o<e;++o)for(var a,r,s=n[o],c=s.length,h=i[o]=new Array(c),l=0;l<c;++l)(a=s[l])&&(r=t.call(a,a.__data__,l,s))&&("__data__"in a&&(r.__data__=a.__data__),h[l]=r);return new ht(i,this._parents)},selectAll:function(t){"function"!=typeof t&&(t=function(t){return null==t?l:function(){return this.querySelectorAll(t)}}(t));for(var n=this._groups,e=n.length,i=[],o=[],a=0;a<e;++a)for(var r,s=n[a],c=s.length,h=0;h<c;++h)(r=s[h])&&(i.push(t.call(r,r.__data__,h,s)),o.push(r));return new ht(i,o)},filter:function(t){"function"!=typeof t&&(t=function(t){return function(){return this.matches(t)}}(t));for(var n=this._groups,e=n.length,i=new Array(e),o=0;o<e;++o)for(var a,r=n[o],s=r.length,c=i[o]=[],h=0;h<s;++h)(a=r[h])&&t.call(a,a.__data__,h,r)&&c.push(a);return new ht(i,this._parents)},data:function(t,n){if(!t)return y=new Array(this.size()),u=-1,this.each((function(t){y[++u]=t})),y;var e,i=n?d:_,o=this._parents,a=this._groups;"function"!=typeof t&&(e=t,t=function(){return e});for(var r=a.length,s=new Array(r),c=new Array(r),h=new Array(r),u=0;u<r;++u){var l=o[u],f=a[u],p=f.length,y=t.call(l,l&&l.__data__,u,o),v=y.length,x=c[u]=new Array(v),g=s[u]=new Array(v);i(l,f,x,g,h[u]=new Array(p),y,n);for(var m,b,w=0,k=0;w<v;++w)if(m=x[w]){for(w>=k&&(k=w+1);!(b=g[k])&&++k<v;);m._next=b||null}}return(s=new ht(s,o))._enter=c,s._exit=h,s},enter:function(){return new ht(this._enter||this._groups.map(f),this._parents)},exit:function(){return new ht(this._exit||this._groups.map(f),this._parents)},join:function(t,n,e){var i=this.enter(),o=this,a=this.exit();return i="function"==typeof t?t(i):i.append(t+""),null!=n&&(o=n(o)),null==e?a.remove():e(a),i&&o?i.merge(o).order():o},merge:function(t){for(var n=this._groups,e=t._groups,i=n.length,o=e.length,a=Math.min(i,o),r=new Array(i),s=0;s<a;++s)for(var c,h=n[s],u=e[s],l=h.length,f=r[s]=new Array(l),p=0;p<l;++p)(c=h[p]||u[p])&&(f[p]=c);for(;s<i;++s)r[s]=n[s];return new ht(r,this._parents)},order:function(){for(var t=this._groups,n=-1,e=t.length;++n<e;)for(var i,o=t[n],a=o.length-1,r=o[a];--a>=0;)(i=o[a])&&(r&&4^i.compareDocumentPosition(r)&&r.parentNode.insertBefore(i,r),r=i);return this},sort:function(t){function n(n,e){return n&&e?t(n.__data__,e.__data__):!n-!e}t||(t=y);for(var e=this._groups,i=e.length,o=new Array(i),a=0;a<i;++a){for(var r,s=e[a],c=s.length,h=o[a]=new Array(c),u=0;u<c;++u)(r=s[u])&&(h[u]=r);h.sort(n)}return new ht(o,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){var t=new Array(this.size()),n=-1;return this.each((function(){t[++n]=this})),t},node:function(){for(var t=this._groups,n=0,e=t.length;n<e;++n)for(var i=t[n],o=0,a=i.length;o<a;++o){var r=i[o];if(r)return r}return null},size:function(){var t=0;return this.each((function(){++t})),t},empty:function(){return!this.node()},each:function(t){for(var n=this._groups,e=0,i=n.length;e<i;++e)for(var o,a=n[e],r=0,s=a.length;r<s;++r)(o=a[r])&&t.call(o,o.__data__,r,a);return this},attr:function(t,n){var e=a(t);if(arguments.length<2){var i=this.node();return e.local?i.getAttributeNS(e.space,e.local):i.getAttribute(e)}return this.each((null==n?e.local?x:v:"function"==typeof n?e.local?w:b:e.local?m:g)(e,n))},style:function(t,n,e){return arguments.length>1?this.each((null==n?M:"function"==typeof n?N:j)(t,n,null==e?"":e)):S(this.node(),t)},property:function(t,n){return arguments.length>1?this.each((null==n?T:"function"==typeof n?O:A)(t,n)):this.node()[t]},classed:function(t,n){var e=P(t+"");if(arguments.length<2){for(var i=E(this.node()),o=-1,a=e.length;++o<a;)if(!i.contains(e[o]))return!1;return!0}return this.each(("function"==typeof n?I:n?B:D)(e,n))},text:function(t){return arguments.length?this.each(null==t?z:("function"==typeof t?X:W)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?H:("function"==typeof t?Y:L)(t)):this.node().innerHTML},raise:function(){return this.each(V)},lower:function(){return this.each(F)},append:function(t){var n="function"==typeof t?t:c(t);return this.select((function(){return this.appendChild(n.apply(this,arguments))}))},insert:function(t,n){var e="function"==typeof t?t:c(t),i=null==n?U:"function"==typeof n?n:u(n);return this.select((function(){return this.insertBefore(e.apply(this,arguments),i.apply(this,arguments)||null)}))},remove:function(){return this.each(G)},clone:function(t){return this.select(t?$:J)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,n,e){var i,o,a=nt(t+""),r=a.length;if(!(arguments.length<2)){for(s=n?it:et,null==e&&(e=!1),i=0;i<r;++i)this.each(s(a[i],n,e));return this}var s=this.node().__on;if(s)for(var c,h=0,u=s.length;h<u;++h)for(i=0,c=s[h];i<r;++i)if((o=a[i]).type===c.type&&o.name===c.name)return c.value},dispatch:function(t,n){return this.each(("function"==typeof n?st:rt)(t,n))}};var lt=0;function ft(){this._="@"+(++lt).toString(36)}function pt(){for(var t,n=K;t=n.sourceEvent;)n=t;return n}function _t(t,n){var e=t.ownerSVGElement||t;if(e.createSVGPoint){var i=e.createSVGPoint();return i.x=n.clientX,i.y=n.clientY,[(i=i.matrixTransform(t.getScreenCTM().inverse())).x,i.y]}var o=t.getBoundingClientRect();return[n.clientX-o.left-t.clientLeft,n.clientY-o.top-t.clientTop]}function dt(t){var n=pt();return n.changedTouches&&(n=n.changedTouches[0]),_t(t,n)}function yt(t,n,e){arguments.length<3&&(e=n,n=pt().changedTouches);for(var i,o=0,a=n?n.length:0;o<a;++o)if((i=n[o]).identifier===e)return _t(t,i);return null}ft.prototype=function(){return new ft}.prototype={constructor:ft,get:function(t){for(var n=this._;!(n in t);)if(!(t=t.parentNode))return;return t[n]},set:function(t,n){return t[this._]=n},remove:function(t){return this._ in t&&delete t[this._]},toString:function(){return this._}};var vt={value:function(){}};function xt(){for(var t,n=0,e=arguments.length,i={};n<e;++n){if(!(t=arguments[n]+"")||t in i)throw new Error("illegal type: "+t);i[t]=[]}return new gt(i)}function gt(t){this._=t}function mt(t,n){return t.trim().split(/^|\s+/).map((function(t){var e="",i=t.indexOf(".");if(i>=0&&(e=t.slice(i+1),t=t.slice(0,i)),t&&!n.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}}))}function bt(t,n){for(var e,i=0,o=t.length;i<o;++i)if((e=t[i]).name===n)return e.value}function wt(t,n,e){for(var i=0,o=t.length;i<o;++i)if(t[i].name===n){t[i]=vt,t=t.slice(0,i).concat(t.slice(i+1));break}return null!=e&&t.push({name:n,value:e}),t}gt.prototype=xt.prototype={constructor:gt,on:function(t,n){var e,i=this._,o=mt(t+"",i),a=-1,r=o.length;if(!(arguments.length<2)){if(null!=n&&"function"!=typeof n)throw new Error("invalid callback: "+n);for(;++a<r;)if(e=(t=o[a]).type)i[e]=wt(i[e],t.name,n);else if(null==n)for(e in i)i[e]=wt(i[e],t.name,null);return this}for(;++a<r;)if((e=(t=o[a]).type)&&(e=bt(i[e],t.name)))return e},copy:function(){var t={},n=this._;for(var e in n)t[e]=n[e].slice();return new gt(t)},call:function(t,n){if((e=arguments.length-2)>0)for(var e,i,o=new Array(e),a=0;a<e;++a)o[a]=arguments[a+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=0,e=(i=this._[t]).length;a<e;++a)i[a].value.apply(n,o)},apply:function(t,n,e){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],o=0,a=i.length;o<a;++o)i[o].value.apply(n,e)}};const kt=xt;function Mt(){K.stopImmediatePropagation()}function jt(){K.preventDefault(),K.stopImmediatePropagation()}function Nt(t){var n=t.document.documentElement,e=ut(t).on("dragstart.drag",jt,!0);"onselectstart"in n?e.on("selectstart.drag",jt,!0):(n.__noselect=n.style.MozUserSelect,n.style.MozUserSelect="none")}function St(t){return function(){return t}}function Tt(t,n,e,i,o,a,r,s,c,h){this.target=t,this.type=n,this.subject=e,this.identifier=i,this.active=o,this.x=a,this.y=r,this.dx=s,this.dy=c,this._=h}function At(){return!K.button}function Ot(){return this.parentNode}function Pt(t){return null==t?{x:K.x,y:K.y}:t}function Et(){return"ontouchstart"in this}function Ct(){var t,n,e,i,o=At,a=Ot,r=Pt,s=Et,c={},h=kt("start","drag","end"),u=0,l=0;function f(t){t.on("mousedown.drag",p).filter(s).on("touchstart.drag",y).on("touchmove.drag",v).on("touchend.drag touchcancel.drag",x).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function p(){if(!i&&o.apply(this,arguments)){var r=g("mouse",a.apply(this,arguments),dt,this,arguments);r&&(ut(K.view).on("mousemove.drag",_,!0).on("mouseup.drag",d,!0),Nt(K.view),Mt(),e=!1,t=K.clientX,n=K.clientY,r("start"))}}function _(){if(jt(),!e){var i=K.clientX-t,o=K.clientY-n;e=i*i+o*o>l}c.mouse("drag")}function d(){ut(K.view).on("mousemove.drag mouseup.drag",null),function(t,n){var e=t.document.documentElement,i=ut(t).on("dragstart.drag",null);n&&(i.on("click.drag",jt,!0),setTimeout((function(){i.on("click.drag",null)}),0)),"onselectstart"in e?i.on("selectstart.drag",null):(e.style.MozUserSelect=e.__noselect,delete e.__noselect)}(K.view,e),jt(),c.mouse("end")}function y(){if(o.apply(this,arguments)){var t,n,e=K.changedTouches,i=a.apply(this,arguments),r=e.length;for(t=0;t<r;++t)(n=g(e[t].identifier,i,yt,this,arguments))&&(Mt(),n("start"))}}function v(){var t,n,e=K.changedTouches,i=e.length;for(t=0;t<i;++t)(n=c[e[t].identifier])&&(jt(),n("drag"))}function x(){var t,n,e=K.changedTouches,o=e.length;for(i&&clearTimeout(i),i=setTimeout((function(){i=null}),500),t=0;t<o;++t)(n=c[e[t].identifier])&&(Mt(),n("end"))}function g(t,n,e,i,o){var a,s,l,p=e(n,t),_=h.copy();if(ot(new Tt(f,"beforestart",a,t,u,p[0],p[1],0,0,_),(function(){return null!=(K.subject=a=r.apply(i,o))&&(s=a.x-p[0]||0,l=a.y-p[1]||0,!0)})))return function r(h){var d,y=p;switch(h){case"start":c[t]=r,d=u++;break;case"end":delete c[t],--u;case"drag":p=e(n,t),d=u}ot(new Tt(f,h,a,t,d,p[0]+s,p[1]+l,p[0]-y[0],p[1]-y[1],_),_.apply,_,[h,i,o])}}return f.filter=function(t){return arguments.length?(o="function"==typeof t?t:St(!!t),f):o},f.container=function(t){return arguments.length?(a="function"==typeof t?t:St(t),f):a},f.subject=function(t){return arguments.length?(r="function"==typeof t?t:St(t),f):r},f.touchable=function(t){return arguments.length?(s="function"==typeof t?t:St(!!t),f):s},f.on=function(){var t=h.on.apply(h,arguments);return t===h?f:t},f.clickDistance=function(t){return arguments.length?(l=(t=+t)*t,f):Math.sqrt(l)},f}Tt.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};var Rt=e(4693);function qt(t){return function(){return t}}var Bt=1e-12,Dt=Math.PI,It=Dt/2,zt=2*Dt;function Wt(t){return t.innerRadius}function Xt(t){return t.outerRadius}function Ht(t){return t.startAngle}function Lt(t){return t.endAngle}function Yt(t){return t&&t.padAngle}function Vt(t){return t>=1?It:t<=-1?-It:Math.asin(t)}function Ft(t,n,e,i,o,a,r,s){var c=e-t,h=i-n,u=r-o,l=s-a,f=(u*(n-a)-l*(t-o))/(l*c-u*h);return[t+f*c,n+f*h]}function Ut(t,n,e,i,o,a,r){var s=t-e,c=n-i,h=(r?a:-a)/Math.sqrt(s*s+c*c),u=h*c,l=-h*s,f=t+u,p=n+l,_=e+u,d=i+l,y=(f+_)/2,v=(p+d)/2,x=_-f,g=d-p,m=x*x+g*g,b=o-a,w=f*d-_*p,k=(g<0?-1:1)*Math.sqrt(Math.max(0,b*b*m-w*w)),M=(w*g-x*k)/m,j=(-w*x-g*k)/m,N=(w*g+x*k)/m,S=(-w*x+g*k)/m,T=M-y,A=j-v,O=N-y,P=S-v;return T*T+A*A>O*O+P*P&&(M=N,j=S),{cx:M,cy:j,x01:-u,y01:-l,x11:M*(o/b-1),y11:j*(o/b-1)}}function Gt(t){this._context=t}function Jt(t){return new Gt(t)}function $t(t){return t[0]}function Qt(t){return t[1]}function Kt(t){this._curve=t}Gt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2;default:this._context.lineTo(t,n)}}},Kt.prototype={areaStart:function(){this._curve.areaStart()},areaEnd:function(){this._curve.areaEnd()},lineStart:function(){this._curve.lineStart()},lineEnd:function(){this._curve.lineEnd()},point:function(t,n){this._curve.point(n*Math.sin(t),n*-Math.cos(t))}},Math.sqrt(1/3);Math.sin(Dt/10),Math.sin(7*Dt/10);function Zt(){}function tn(t,n,e){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+n)/6,(t._y0+4*t._y1+e)/6)}function nn(t){this._context=t}function en(t,n){this._basis=new nn(t),this._beta=n}function on(t,n,e){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-n),t._y2+t._k*(t._y1-e),t._x2,t._y2)}function an(t,n){this._context=t,this._k=(1-n)/6}function rn(t,n){this._context=t,this._k=(1-n)/6}function sn(t,n){this._context=t,this._k=(1-n)/6}function cn(t,n,e){var i=t._x1,o=t._y1,a=t._x2,r=t._y2;if(t._l01_a>Bt){var s=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,c=3*t._l01_a*(t._l01_a+t._l12_a);i=(i*s-t._x0*t._l12_2a+t._x2*t._l01_2a)/c,o=(o*s-t._y0*t._l12_2a+t._y2*t._l01_2a)/c}if(t._l23_a>Bt){var h=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,u=3*t._l23_a*(t._l23_a+t._l12_a);a=(a*h+t._x1*t._l23_2a-n*t._l12_2a)/u,r=(r*h+t._y1*t._l23_2a-e*t._l12_2a)/u}t._context.bezierCurveTo(i,o,a,r,t._x2,t._y2)}function hn(t,n){this._context=t,this._alpha=n}Math.sin(zt/10),Math.cos(zt/10),Math.sqrt(3),Math.sqrt(3),Math.sqrt(12),nn.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:tn(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:tn(this,t,n)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=n}},en.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var t=this._x,n=this._y,e=t.length-1;if(e>0)for(var i,o=t[0],a=n[0],r=t[e]-o,s=n[e]-a,c=-1;++c<=e;)i=c/e,this._basis.point(this._beta*t[c]+(1-this._beta)*(o+i*r),this._beta*n[c]+(1-this._beta)*(a+i*s));this._x=this._y=null,this._basis.lineEnd()},point:function(t,n){this._x.push(+t),this._y.push(+n)}},function t(n){function e(t){return 1===n?new nn(t):new en(t,n)}return e.beta=function(n){return t(+n)},e}(.85),an.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:on(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2,this._x1=t,this._y1=n;break;case 2:this._point=3;default:on(this,t,n)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=n}},function t(n){function e(t){return new an(t,n)}return e.tension=function(n){return t(+n)},e}(0),rn.prototype={areaStart:Zt,areaEnd:Zt,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1,this._x3=t,this._y3=n;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=n);break;case 2:this._point=3,this._x5=t,this._y5=n;break;default:on(this,t,n)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=n}},function t(n){function e(t){return new rn(t,n)}return e.tension=function(n){return t(+n)},e}(0),sn.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:on(this,t,n)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=n}},function t(n){function e(t){return new sn(t,n)}return e.tension=function(n){return t(+n)},e}(0),hn.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){if(t=+t,n=+n,this._point){var e=this._x2-t,i=this._y2-n;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(e*e+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2;break;case 2:this._point=3;default:cn(this,t,n)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=n}};const un=function t(n){function e(t){return n?new hn(t,n):new an(t,0)}return e.alpha=function(n){return t(+n)},e}(.5);function ln(t,n){this._context=t,this._alpha=n}function fn(t,n){this._context=t,this._alpha=n}function pn(t){return t<0?-1:1}function _n(t,n,e){var i=t._x1-t._x0,o=n-t._x1,a=(t._y1-t._y0)/(i||o<0&&-0),r=(e-t._y1)/(o||i<0&&-0),s=(a*o+r*i)/(i+o);return(pn(a)+pn(r))*Math.min(Math.abs(a),Math.abs(r),.5*Math.abs(s))||0}function dn(t,n){var e=t._x1-t._x0;return e?(3*(t._y1-t._y0)/e-n)/2:n}function yn(t,n,e){var i=t._x0,o=t._y0,a=t._x1,r=t._y1,s=(a-i)/3;t._context.bezierCurveTo(i+s,o+s*n,a-s,r-s*e,a,r)}function vn(t){this._context=t}function xn(t){this._context=t}ln.prototype={areaStart:Zt,areaEnd:Zt,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,n){if(t=+t,n=+n,this._point){var e=this._x2-t,i=this._y2-n;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(e*e+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=n;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=n);break;case 2:this._point=3,this._x5=t,this._y5=n;break;default:cn(this,t,n)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=n}},function t(n){function e(t){return n?new ln(t,n):new rn(t,0)}return e.alpha=function(n){return t(+n)},e}(.5),fn.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){if(t=+t,n=+n,this._point){var e=this._x2-t,i=this._y2-n;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(e*e+i*i,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:cn(this,t,n)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=n}},function t(n){function e(t){return n?new fn(t,n):new sn(t,0)}return e.alpha=function(n){return t(+n)},e}(.5),vn.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:yn(this,this._t0,dn(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){var e=NaN;if(n=+n,(t=+t)!==this._x1||n!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2;break;case 2:this._point=3,yn(this,dn(this,e=_n(this,t,n)),e);break;default:yn(this,this._t0,e=_n(this,t,n))}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=n,this._t0=e}}},(function(t){this._context=new xn(t)}.prototype=Object.create(vn.prototype)).point=function(t,n){vn.prototype.point.call(this,n,t)},xn.prototype={moveTo:function(t,n){this._context.moveTo(n,t)},closePath:function(){this._context.closePath()},lineTo:function(t,n){this._context.lineTo(n,t)},bezierCurveTo:function(t,n,e,i,o,a){this._context.bezierCurveTo(n,t,i,e,a,o)}},Array.prototype.slice;var gn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mn=function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")},bn=function(){function t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}}(),wn=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},kn=function t(n,e,i){null===n&&(n=Function.prototype);var o=Object.getOwnPropertyDescriptor(n,e);if(void 0===o){var a=Object.getPrototypeOf(n);return null===a?void 0:t(a,e,i)}if("value"in o)return o.value;var r=o.get;return void 0!==r?r.call(i):void 0},Mn=function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(t,n):t.__proto__=n)},jn=function(t,n){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?t:n},Nn=function(){function t(n){var e=n.x,i=void 0===e?0:e,o=n.y,a=void 0===o?0:o,r=n.nx,s=n.ny,c=n.dy,h=void 0===c?0:c,u=n.dx,l=void 0===u?0:u,f=n.color,p=void 0===f?"grey":f,_=n.data,d=n.type,y=n.subject,v=n.connector,x=n.note,g=n.disable,m=n.id,b=n.className;mn(this,t),this._dx=void 0!==r?r-i:l,this._dy=void 0!==s?s-a:h,this._x=i,this._y=a,this._color=p,this.id=m,this._className=b||"",this._type=d||"",this.data=_,this.note=x||{},this.connector=v||{},this.subject=y||{},this.disable=g||[]}return bn(t,[{key:"updatePosition",value:function(){this.type.setPosition&&(this.type.setPosition(),this.type.subject&&0!==this.type.subject.selectAll(":not(.handle)").nodes().length&&this.type.redrawSubject())}},{key:"clearComponents",value:function(){this.type.clearComponents&&this.type.clearComponents()}},{key:"updateOffset",value:function(){this.type.setOffset&&(this.type.setOffset(),0!==this.type.connector.selectAll(":not(.handle)").nodes().length&&this.type.redrawConnector(),this.type.redrawNote())}},{key:"className",get:function(){return this._className},set:function(t){this._className=t,this.type.setClassName&&this.type.setClassName()}},{key:"type",get:function(){return this._type},set:function(t){this._type=t,this.clearComponents()}},{key:"x",get:function(){return this._x},set:function(t){this._x=t,this.updatePosition()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this.updatePosition()}},{key:"color",get:function(){return this._color},set:function(t){this._color=t,this.updatePosition()}},{key:"dx",get:function(){return this._dx},set:function(t){this._dx=t,this.updateOffset()}},{key:"dy",get:function(){return this._dy},set:function(t){this._dy=t,this.updateOffset()}},{key:"nx",set:function(t){this._dx=t-this._x,this.updateOffset()}},{key:"ny",set:function(t){this._dy=t-this._y,this.updateOffset()}},{key:"offset",get:function(){return{x:this._dx,y:this._dy}},set:function(t){var n=t.x,e=t.y;this._dx=n,this._dy=e,this.updateOffset()}},{key:"position",get:function(){return{x:this._x,y:this._y}},set:function(t){var n=t.x,e=t.y;this._x=n,this._y=e,this.updatePosition()}},{key:"translation",get:function(){return{x:this._x+this._dx,y:this._y+this._dy}}},{key:"json",get:function(){var t={x:this._x,y:this._y,dx:this._dx,dy:this._dy};return this.data&&Object.keys(this.data).length>0&&(t.data=this.data),this.type&&(t.type=this.type),this._className&&(t.className=this._className),Object.keys(this.connector).length>0&&(t.connector=this.connector),Object.keys(this.subject).length>0&&(t.subject=this.subject),Object.keys(this.note).length>0&&(t.note=this.note),t}}]),t}(),Sn=function(){function t(n){var e=n.annotations,i=n.accessors,o=n.accessorsInverse;mn(this,t),this.accessors=i,this.accessorsInverse=o,this.annotations=e}return bn(t,[{key:"clearTypes",value:function(t){this.annotations.forEach((function(n){n.type=void 0,n.subject=t&&t.subject||n.subject,n.connector=t&&t.connector||n.connector,n.note=t&&t.note||n.note}))}},{key:"setPositionWithAccessors",value:function(){var t=this;this.annotations.forEach((function(n){n.type.setPositionWithAccessors(t.accessors)}))}},{key:"editMode",value:function(t){this.annotations.forEach((function(n){n.type&&(n.type.editMode=t,n.type.updateEditMode())}))}},{key:"updateDisable",value:function(t){this.annotations.forEach((function(n){n.disable=t,n.type&&t.forEach((function(t){n.type[t]&&(n.type[t].remove&&n.type[t].remove(),n.type[t]=void 0)}))}))}},{key:"updateTextWrap",value:function(t){this.annotations.forEach((function(n){n.type&&n.type.updateTextWrap&&n.type.updateTextWrap(t)}))}},{key:"updateText",value:function(){this.annotations.forEach((function(t){t.type&&t.type.drawText&&t.type.drawText()}))}},{key:"updateNotePadding",value:function(t){this.annotations.forEach((function(n){n.type&&(n.type.notePadding=t)}))}},{key:"json",get:function(){var t=this;return this.annotations.map((function(n){var e=n.json;return t.accessorsInverse&&n.data&&(e.data={},Object.keys(t.accessorsInverse).forEach((function(i){e.data[i]=t.accessorsInverse[i]({x:n.x,y:n.y})}))),e}))}},{key:"noteNodes",get:function(){return this.annotations.map((function(t){return wn({},t.type.getNoteBBoxOffset(),{positionX:t.x,positionY:t.y})}))}}]),t}(),Tn=function(t,n){return"dynamic"!==t&&"left"!==t&&"right"!==t||(t=n<0?"top":"bottom"),t},An=function(t,n){return"dynamic"!==t&&"top"!==t&&"bottom"!==t||(t=n<0?"right":"left"),t},On=["topBottom","top","bottom"],Pn=["leftRight","left","right"],En=function(t){var n=t.data,e=t.curve,i=void 0===e?Jt:e,o=t.canvasContext,a=t.className,r=t.classID,s=function(){var t=$t,n=Qt,e=qt(!0),i=null,o=Jt,a=null;function r(r){var s,c,h,u=r.length,l=!1;for(null==i&&(a=o(h=(0,Rt.E)())),s=0;s<=u;++s)!(s<u&&e(c=r[s],s,r))===l&&((l=!l)?a.lineStart():a.lineEnd()),l&&a.point(+t(c,s,r),+n(c,s,r));if(h)return a=null,h+""||null}return r.x=function(n){return arguments.length?(t="function"==typeof n?n:qt(+n),r):t},r.y=function(t){return arguments.length?(n="function"==typeof t?t:qt(+t),r):n},r.defined=function(t){return arguments.length?(e="function"==typeof t?t:qt(!!t),r):e},r.curve=function(t){return arguments.length?(o=t,null!=i&&(a=o(i)),r):o},r.context=function(t){return arguments.length?(null==t?i=a=null:a=o(i=t),r):i},r}().curve(i),c={type:"path",className:a,classID:r,data:n};return o?(s.context(o),c.pathMethods=s):c.attrs={d:s(n)},c},Cn=function(t){var n=t.data,e=t.canvasContext,i={type:"path",className:t.className,classID:t.classID,data:n},o=function(){var t=Wt,n=Xt,e=qt(0),i=null,o=Ht,a=Lt,r=Yt,s=null;function c(){var c,h,u=+t.apply(this,arguments),l=+n.apply(this,arguments),f=o.apply(this,arguments)-It,p=a.apply(this,arguments)-It,_=Math.abs(p-f),d=p>f;if(s||(s=c=(0,Rt.E)()),l<u&&(h=l,l=u,u=h),l>Bt)if(_>zt-Bt)s.moveTo(l*Math.cos(f),l*Math.sin(f)),s.arc(0,0,l,f,p,!d),u>Bt&&(s.moveTo(u*Math.cos(p),u*Math.sin(p)),s.arc(0,0,u,p,f,d));else{var y,v,x=f,g=p,m=f,b=p,w=_,k=_,M=r.apply(this,arguments)/2,j=M>Bt&&(i?+i.apply(this,arguments):Math.sqrt(u*u+l*l)),N=Math.min(Math.abs(l-u)/2,+e.apply(this,arguments)),S=N,T=N;if(j>Bt){var A=Vt(j/u*Math.sin(M)),O=Vt(j/l*Math.sin(M));(w-=2*A)>Bt?(m+=A*=d?1:-1,b-=A):(w=0,m=b=(f+p)/2),(k-=2*O)>Bt?(x+=O*=d?1:-1,g-=O):(k=0,x=g=(f+p)/2)}var P=l*Math.cos(x),E=l*Math.sin(x),C=u*Math.cos(b),R=u*Math.sin(b);if(N>Bt){var q=l*Math.cos(g),B=l*Math.sin(g),D=u*Math.cos(m),I=u*Math.sin(m);if(_<Dt){var z=w>Bt?Ft(P,E,D,I,q,B,C,R):[C,R],W=P-z[0],X=E-z[1],H=q-z[0],L=B-z[1],Y=1/Math.sin(Math.acos((W*H+X*L)/(Math.sqrt(W*W+X*X)*Math.sqrt(H*H+L*L)))/2),V=Math.sqrt(z[0]*z[0]+z[1]*z[1]);S=Math.min(N,(u-V)/(Y-1)),T=Math.min(N,(l-V)/(Y+1))}}k>Bt?T>Bt?(y=Ut(D,I,P,E,l,T,d),v=Ut(q,B,C,R,l,T,d),s.moveTo(y.cx+y.x01,y.cy+y.y01),T<N?s.arc(y.cx,y.cy,T,Math.atan2(y.y01,y.x01),Math.atan2(v.y01,v.x01),!d):(s.arc(y.cx,y.cy,T,Math.atan2(y.y01,y.x01),Math.atan2(y.y11,y.x11),!d),s.arc(0,0,l,Math.atan2(y.cy+y.y11,y.cx+y.x11),Math.atan2(v.cy+v.y11,v.cx+v.x11),!d),s.arc(v.cx,v.cy,T,Math.atan2(v.y11,v.x11),Math.atan2(v.y01,v.x01),!d))):(s.moveTo(P,E),s.arc(0,0,l,x,g,!d)):s.moveTo(P,E),u>Bt&&w>Bt?S>Bt?(y=Ut(C,R,q,B,u,-S,d),v=Ut(P,E,D,I,u,-S,d),s.lineTo(y.cx+y.x01,y.cy+y.y01),S<N?s.arc(y.cx,y.cy,S,Math.atan2(y.y01,y.x01),Math.atan2(v.y01,v.x01),!d):(s.arc(y.cx,y.cy,S,Math.atan2(y.y01,y.x01),Math.atan2(y.y11,y.x11),!d),s.arc(0,0,u,Math.atan2(y.cy+y.y11,y.cx+y.x11),Math.atan2(v.cy+v.y11,v.cx+v.x11),d),s.arc(v.cx,v.cy,S,Math.atan2(v.y11,v.x11),Math.atan2(v.y01,v.x01),!d))):s.arc(0,0,u,b,m,d):s.lineTo(C,R)}else s.moveTo(0,0);if(s.closePath(),c)return s=null,c+""||null}return c.centroid=function(){var e=(+t.apply(this,arguments)+ +n.apply(this,arguments))/2,i=(+o.apply(this,arguments)+ +a.apply(this,arguments))/2-Dt/2;return[Math.cos(i)*e,Math.sin(i)*e]},c.innerRadius=function(n){return arguments.length?(t="function"==typeof n?n:qt(+n),c):t},c.outerRadius=function(t){return arguments.length?(n="function"==typeof t?t:qt(+t),c):n},c.cornerRadius=function(t){return arguments.length?(e="function"==typeof t?t:qt(+t),c):e},c.padRadius=function(t){return arguments.length?(i=null==t?null:"function"==typeof t?t:qt(+t),c):i},c.startAngle=function(t){return arguments.length?(o="function"==typeof t?t:qt(+t),c):o},c.endAngle=function(t){return arguments.length?(a="function"==typeof t?t:qt(+t),c):a},c.padAngle=function(t){return arguments.length?(r="function"==typeof t?t:qt(+t),c):r},c.context=function(t){return arguments.length?(s=null==t?null:t,c):s},c}().innerRadius(n.innerRadius||0).outerRadius(n.outerRadius||n.radius||2).startAngle(n.startAngle||0).endAngle(n.endAngle||2*Math.PI);return e?(o.context(e),i.pathMethods=lineGen):i.attrs={d:o()},i},Rn=function(t){var n=t.align,e=t.x,i=void 0===e?0:e,o=t.y,a=void 0===o?0:o,r=t.bbox,s=t.offset;"top"===(n=Tn(n,s.y))?a-=r.height:"middle"===n&&(a-=r.height/2);var c=[[i,a],[i,a+r.height]];return{components:[En({data:c,className:"note-line"})]}},qn=function(t){var n=t.align,e=t.x,i=void 0===e?0:e,o=t.y,a=void 0===o?0:o,r=t.offset,s=t.bbox;"right"===(n=An(n,r.x))?i-=s.width:"middle"===n&&(i-=s.width/2);var c=[[i,a],[i+s.width,a]];return{components:[En({data:c,className:"note-line"})]}},Bn=function(t){var n=t.type,e=t.subjectType,i=n.annotation,o=i.position,a=i.x-o.x,r=a+i.dx,s=i.y-o.y,c=s+i.dy,h=i.subject;if("circle"===e&&(h.outerRadius||h.radius)){var u=Math.sqrt((a-r)*(a-r)+(s-c)*(s-c)),l=Math.asin(-c/u),f=h.outerRadius||h.radius+(h.radiusPadding||0);a=Math.abs(Math.cos(l)*f)*(r<0?-1:1),s=Math.abs(Math.sin(l)*f)*(c<0?-1:1)}if("rect"===e){var p=h.width,_=h.height;(p>0&&i.dx>0||p<0&&i.dx<0)&&(a=Math.abs(p)>Math.abs(i.dx)?p/2:p),(_>0&&i.dy>0||_<0&&i.dy<0)&&(s=Math.abs(_)>Math.abs(i.dy)?_/2:_),a===p/2&&s===_/2&&(a=r,s=c)}return[[a,s],[r,c]]},Dn=function(t){var n=Bn(t);return{components:[En({data:n,className:"connector"})]}},In=function(t){var n=t.type,e=t.subjectType,i=n.annotation,o=i.position,a=i.x-o.x,r=a+i.dx,s=i.y-o.y,c=s+i.dy,h=i.subject;if("rect"===e){var u=h.width,l=h.height;(u>0&&i.dx>0||u<0&&i.dx<0)&&(a=Math.abs(u)>Math.abs(i.dx)?u/2:u),(l>0&&i.dy>0||l<0&&i.dy<0)&&(s=Math.abs(l)>Math.abs(i.dy)?l/2:l),a===u/2&&s===l/2&&(a=r,s=c)}var f=[[a,s],[r,c]],p=c-s,_=r-a,d=r,y=c,v=c<s&&r>a||r<a&&c>s?-1:1;if(Math.abs(_)<Math.abs(p)?(d=r,y=s+_*v):(y=c,d=a+p*v),"circle"===e&&(h.outerRadius||h.radius)){var x=(h.outerRadius||h.radius)+(h.radiusPadding||0),g=x/Math.sqrt(2);if(Math.abs(_)>g&&Math.abs(p)>g)f=[[a=g*(r<0?-1:1),s=g*(c<0?-1:1)],[d,y],[r,c]];else if(Math.abs(_)>Math.abs(p)){var m=Math.asin(-c/x);f=[[a=Math.abs(Math.cos(m)*x)*(r<0?-1:1),c],[r,c]]}else{var b=Math.acos(r/x);f=[[r,s=Math.abs(Math.sin(b)*x)*(c<0?-1:1)],[r,c]]}}else f=[[a,s],[d,y],[r,c]];return{components:[En({data:f,className:"connector"})]}},zn=function(t){var n=t.type,e=t.connectorData,i=t.subjectType;e||(e={}),e.points&&"number"!=typeof e.points||(e.points=Wn(n.annotation.offset,e.points)),e.curve||(e.curve=un);var o=[];if(n.editMode){var a=e.points.map((function(t,n){return wn({},function(t){var n=t.cx,e=t.cy;return{move:{x:void 0===n?0:n,y:void 0===e?0:e}}}({cx:t[0],cy:t[1]}),{index:n})})),r=function(t){e.points[t][0]+=K.dx,e.points[t][1]+=K.dy,n.redrawConnector()};o=n.mapHandles(a.map((function(t){return wn({},t.move,{drag:r.bind(n,t.index)})})))}var s=Bn({type:n,subjectType:i});return s=[s[0]].concat(function(t){if(Array.isArray(t)){for(var n=0,e=Array(t.length);n<t.length;n++)e[n]=t[n];return e}return Array.from(t)}(e.points),[s[1]]),{components:[En({data:s,curve:e.curve,className:"connector"})],handles:o}},Wn=function(t){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,e={x:t.x/(n+1),y:t.y/(n+1)},i=[],o=1;o<=n;o++)i.push([e.x*o+o%2*20,e.y*o-o%2*20]);return i},Xn=function(t){var n=t.annotation,e=t.start,i=t.end,o=t.scale,a=void 0===o?1:o,r=n.position;e=e?[-i[0]+e[0],-i[1]+e[1]]:[n.dx,n.dy],i||(i=[n.x-r.x,n.y-r.y]);var s=i[0],c=i[1],h=e[0],u=e[1],l=10*a,f=16/180*Math.PI,p=Math.atan(u/h);h<0&&(p+=Math.PI);var _=[[s,c],[Math.cos(p+f)*l+s,Math.sin(p+f)*l+c],[Math.cos(p-f)*l+s,Math.sin(p-f)*l+c],[s,c]];return{components:[En({data:_,className:"connector-end connector-arrow",classID:"connector-end"})]}},Hn=function(t){var n=t.line,e=t.scale,i=void 0===e?1:e,o=Cn({className:"connector-end connector-dot",classID:"connector-end",data:{radius:3*Math.sqrt(i)}});return o.attrs.transform="translate("+n.data[0][0]+", "+n.data[0][1]+")",{components:[o]}},Ln=function(t){var n=t.subjectData,e=t.type;n.radius||n.outerRadius||(n.radius=20);var i=[],o=Cn({data:n,className:"subject"});if(e.editMode){var a=function(t){var n=t.cx,e=void 0===n?0:n,i=t.cy,o=void 0===i?0:i,a=t.r1,r=t.r2,s=t.padding,c={move:{x:e,y:o}};return void 0!==a&&(c.r1={x:e+a/Math.sqrt(2),y:o+a/Math.sqrt(2)}),void 0!==r&&(c.r2={x:e+r/Math.sqrt(2),y:o+r/Math.sqrt(2)}),void 0!==s&&(c.padding={x:e+a+s,y:o}),c}({r1:o.data.outerRadius||o.data.radius,r2:o.data.innerRadius,padding:n.radiusPadding}),r=function(t){var i=n[t]+K.dx*Math.sqrt(2);n[t]=i,e.redrawSubject(),e.redrawConnector()},s=[wn({},a.r1,{drag:r.bind(e,void 0!==n.outerRadius?"outerRadius":"radius")})];n.innerRadius&&s.push(wn({},a.r2,{drag:r.bind(e,"innerRadius")})),i=e.mapHandles(s)}return o.attrs["fill-opacity"]=0,{components:[o],handles:i}},Yn=function(t){var n=t.subjectData,e=t.type;n.width||(n.width=100),n.height||(n.height=100);var i=[],o=n.width,a=n.height,r=En({data:[[0,0],[o,0],[o,a],[0,a],[0,0]],className:"subject"});if(e.editMode){var s=[{x:o,y:a/2,drag:function(){n.width=K.x,e.redrawSubject(),e.redrawConnector()}.bind(e)},{x:o/2,y:a,drag:function(){n.height=K.y,e.redrawSubject(),e.redrawConnector()}.bind(e)}];i=e.mapHandles(s)}return r.attrs["fill-opacity"]=.1,{components:[r],handles:i}},Vn=function(t){var n=t.subjectData,e=t.type.annotation.position,i=(void 0!==n.x1?n.x1:e.x)-e.x,o=(void 0!==n.x2?n.x2:e.x)-e.x,a=(void 0!==n.y1?n.y1:e.y)-e.y,r=(void 0!==n.y2?n.y2:e.y)-e.y;return{components:[En({data:[[i,a],[o,r]],className:"subject"})]}},Fn=function(t){var n=t.subjectData,e=void 0===n?{}:n,i=t.type,o=void 0===i?{}:i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=o.typeSettings&&o.typeSettings.subject;e.radius||(r&&r.radius?e.radius=r.radius:e.radius=14),e.x||r&&r.x&&(e.x=r.x),e.y||r&&r.y&&(e.y=r.y);var s=[],c=[],h=e.radius,u=.7*h,l=0,f=0,p=Math.sqrt(2)*h,_={xleftcorner:-h,xrightcorner:h,ytopcorner:-h,ybottomcorner:h,xleft:-p,xright:p,ytop:-p,ybottom:p};e.x&&!e.y?l=_["x"+e.x]:e.y&&!e.x?f=_["y"+e.y]:e.x&&e.y&&(l=_["x"+e.x+"corner"],f=_["y"+e.y+"corner"]);var d="translate("+l+", "+f+")",y=Cn({className:"subject",data:{radius:h}});y.attrs.transform=d,y.attrs.fill=a.color,y.attrs["stroke-linecap"]="round",y.attrs["stroke-width"]="3px";var v=Cn({className:"subject-ring",data:{outerRadius:h,innerRadius:u}});v.attrs.transform=d,v.attrs["stroke-width"]="3px",v.attrs.fill="white";var x=void 0;if(l&&f||!l&&!f)x=En({className:"subject-pointer",data:[[0,0],[l||0,0],[0,f||0],[0,0]]});else if(l||f){var g=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t&&t/Math.sqrt(2)/Math.sqrt(2)||n*h/Math.sqrt(2)};x=En({className:"subject-pointer",data:[[0,0],[g(l),g(f)],[g(l,-1),g(f,-1)],[0,0]]})}if(x&&(x.attrs.fill=a.color,x.attrs["stroke-linecap"]="round",x.attrs["stroke-width"]="3px",c.push(x)),o.editMode){var m=function(){e.x=K.x<2*-h?"left":K.x>2*h?"right":void 0,e.y=K.y<2*-h?"top":K.y>2*h?"bottom":void 0,o.redrawSubject()},b={x:2*l,y:2*f,drag:m.bind(o)};b.x||b.y||(b.y=-h),s=o.mapHandles([b])}var w=void 0;return e.text&&(w={type:"text",className:"badge-text",attrs:{fill:"white",stroke:"none","font-size":".7em",text:e.text,"text-anchor":"middle",dy:".25em",x:l,y:f}}),c.push(y),c.push(v),c.push(w),{components:c,handles:s}},Un=function(){function t(n){var e=n.a,i=n.annotation,o=n.editMode,a=n.dispatcher,r=n.notePadding,s=n.accessors;if(mn(this,t),this.a=e,this.note=-1===i.disable.indexOf("note")&&e.select("g.annotation-note"),this.noteContent=this.note&&e.select("g.annotation-note-content"),this.connector=-1===i.disable.indexOf("connector")&&e.select("g.annotation-connector"),this.subject=-1===i.disable.indexOf("subject")&&e.select("g.annotation-subject"),this.dispatcher=a,a){var c=te.bind(null,a,i);c({component:this.note,name:"note"}),c({component:this.connector,name:"connector"}),c({component:this.subject,name:"subject"})}this.annotation=i,this.editMode=i.editMode||o,this.notePadding=void 0!==r?r:3,this.offsetCornerX=0,this.offsetCornerY=0,s&&i.data&&this.init(s)}return bn(t,[{key:"init",value:function(t){this.annotation.x||this.mapX(t),this.annotation.y||this.mapY(t)}},{key:"mapY",value:function(t){t.y&&(this.annotation.y=t.y(this.annotation.data))}},{key:"mapX",value:function(t){t.x&&(this.annotation.x=t.x(this.annotation.data))}},{key:"updateEditMode",value:function(){this.a.selectAll("circle.handle").remove()}},{key:"drawOnSVG",value:function(t,n){var e=this;Array.isArray(n)||(n=[n]),n.filter((function(t){return t})).forEach((function(n){var i=n.type,o=n.className,a=n.attrs,r=n.handles,s=n.classID;if("handle"===i)!function(t){var n=t.group,e=t.handles,i=t.r,o=void 0===i?10:i,a=n.selectAll("circle.handle").data(e);a.enter().append("circle").attr("class","handle").attr("fill","grey").attr("fill-opacity",.1).attr("cursor","move").attr("stroke-dasharray",5).attr("stroke","grey").call(Ct().container(ut("g.annotations").node()).on("start",(function(t){return t.start&&t.start(t)})).on("drag",(function(t){return t.drag&&t.drag(t)})).on("end",(function(t){return t.end&&t.end(t)}))),n.selectAll("circle.handle").attr("cx",(function(t){return t.x})).attr("cy",(function(t){return t.y})).attr("r",(function(t){return t.r||o})).attr("class",(function(t){return"handle "+(t.className||"")})),a.exit().remove()}({group:t,r:a&&a.r,handles:r});else{Zn(t,[e.annotation],i,o,s);for(var c=t.select(i+"."+(s||o)),h=Object.keys(a),u=[],l=c.node().attributes,f=l.length-1;f>=0;f--){var p=l[f].name;-1===h.indexOf(p)&&"class"!==p&&u.push(p)}h.forEach((function(t){"text"===t?c.text(a[t]):c.attr(t,a[t])})),u.forEach((function(t){return c.attr(t,null)}))}}))}},{key:"getNoteBBox",value:function(){return ee(this.note,".annotation-note-content text")}},{key:"getNoteBBoxOffset",value:function(){var t=ee(this.note,".annotation-note-content"),n=this.noteContent.attr("transform").split(/\(|\,|\)/g);return t.offsetCornerX=parseFloat(n[1])+this.annotation.dx,t.offsetCornerY=parseFloat(n[2])+this.annotation.dy,t.offsetX=this.annotation.dx,t.offsetY=this.annotation.dy,t}},{key:"drawSubject",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.annotation.subject,i=n.type,o={type:this,subjectData:e},a={};"circle"===i?a=Ln(o):"rect"===i?a=Yn(o):"threshold"===i?a=Vn(o):"badge"===i&&(a=Fn(o,this.annotation));var r=a,s=r.components,c=void 0===s?[]:s,h=r.handles,u=void 0===h?[]:h;return c.forEach((function(n){n&&n.attrs&&!n.attrs.stroke&&(n.attrs.stroke=t.annotation.color)})),this.editMode&&(u=u.concat(this.mapHandles([{drag:this.dragSubject.bind(this)}])),c.push({type:"handle",handles:u})),c}},{key:"drawConnector",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.annotation.connector,i=e.type||n.type,o={type:this,connectorData:e};o.subjectType=this.typeSettings&&this.typeSettings.subject&&this.typeSettings.subject.type;var a="curve"===i?zn(o):"elbow"===i?In(o):Dn(o),r=a.components,s=void 0===r?[]:r,c=a.handles,h=void 0===c?[]:c,u=s[0];u&&(u.attrs.stroke=this.annotation.color,u.attrs.fill="none");var l=e.end||n.end,f={};if("arrow"===l){var p=u.data[1],_=u.data[0],d=Math.sqrt(Math.pow(p[0]-_[0],2)+Math.pow(p[1]-_[1],2));d<5&&u.data[2]&&(p=u.data[2]),f=Xn({annotation:this.annotation,start:p,end:_,scale:e.endScale})}else"dot"===l?f=Hn({line:u,scale:e.endScale}):l&&"none"!==l||this.connector&&this.connector.select(".connector-end").remove();return f.components&&(f.components.forEach((function(n){n.attrs.fill=t.annotation.color,n.attrs.stroke=t.annotation.color})),s=s.concat(f.components)),this.editMode&&0!==h.length&&s.push({type:"handle",handles:h}),s}},{key:"drawNote",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.annotation.note,i=e.align||n.align||"dynamic",o={bbox:n.bbox,align:i,offset:this.annotation.offset},a=e.lineType||n.lineType,r={};"vertical"===a?r=Rn(o):"horizontal"===a&&(r=qn(o));var s=r,c=s.components,h=void 0===c?[]:c,u=s.handles,l=void 0===u?[]:u;if(h.forEach((function(n){n.attrs.stroke=t.annotation.color})),this.editMode){l=this.mapHandles([{x:0,y:0,drag:this.dragNote.bind(this)}]),h.push({type:"handle",handles:l});var f=this.dragNote.bind(this),p=this.dragstarted.bind(this),_=this.dragended.bind(this);this.note.call(Ct().container(ut("g.annotations").node()).on("start",(function(t){return p(t)})).on("drag",(function(t){return f(t)})).on("end",(function(t){return _(t)})))}else this.note.on("mousedown.drag",null);return h}},{key:"drawNoteContent",value:function(t){var n=this.annotation.note,e=void 0!==n.padding?n.padding:this.notePadding,i=n.orientation||t.orientation||"topBottom",o=n.lineType||t.lineType,a=n.align||t.align||"dynamic";"vertical"===o?i="leftRight":"horizontal"===o&&(i="topBottom");var r=function(t){var n=t.padding,e=void 0===n?0:n,i=t.bbox,o=void 0===i?{x:0,y:0,width:0,height:0}:i,a=t.align,r=t.orientation,s=t.offset,c=void 0===s?{x:0,y:0}:s,h=-o.x,u=0;return-1!==On.indexOf(r)?(a=An(a,c.x),c.y<0&&"topBottom"===r||"top"===r?u-=o.height+e:u+=e,"middle"===a?h-=o.width/2:"right"===a&&(h-=o.width)):-1!==Pn.indexOf(r)&&(a=Tn(a,c.y),c.x<0&&"leftRight"===r||"left"===r?h-=o.width+e:h+=e,"middle"===a?u-=o.height/2:"top"===a&&(u-=o.height)),{x:h,y:u}}({padding:e,bbox:t.bbox,offset:this.annotation.offset,orientation:i,align:a}),s=r.x,c=r.y;return this.offsetCornerX=s+this.annotation.dx,this.offsetCornerY=c+this.annotation.dy,this.note&&this.noteContent.attr("transform","translate("+s+", "+c+")"),[]}},{key:"drawOnScreen",value:function(t,n){return this.drawOnSVG(t,n)}},{key:"redrawSubject",value:function(){this.subject&&this.drawOnScreen(this.subject,this.drawSubject())}},{key:"redrawConnector",value:function(){this.connector&&this.drawOnScreen(this.connector,this.drawConnector())}},{key:"redrawNote",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getNoteBBox();this.noteContent&&this.drawOnScreen(this.noteContent,this.drawNoteContent({bbox:t})),this.note&&this.drawOnScreen(this.note,this.drawNote({bbox:t}))}},{key:"setPosition",value:function(){var t=this.annotation.position;this.a.attr("transform","translate("+t.x+", "+t.y+")")}},{key:"clearComponents",value:function(){this.subject&&this.subject.select("*").remove(),this.connector&&this.connector.select("*").remove()}},{key:"setOffset",value:function(){if(this.note){var t=this.annotation.offset;this.note.attr("transform","translate("+t.x+", "+t.y+")")}}},{key:"setPositionWithAccessors",value:function(t){t&&this.annotation.data&&(this.mapX(t),this.mapY(t)),this.setPosition()}},{key:"setClassName",value:function(){this.a.attr("class","annotation "+(this.className&&this.className())+" "+(this.editMode?"editable":"")+" "+(this.annotation.className||""))}},{key:"draw",value:function(){this.setClassName(),this.setPosition(),this.setOffset(),this.redrawSubject(),this.redrawConnector(),this.redrawNote()}},{key:"dragstarted",value:function(){K.sourceEvent.stopPropagation(),this.dispatcher&&this.dispatcher.call("dragstart",this.a,this.annotation),this.a.classed("dragging",!0),this.a.selectAll("circle.handle").style("pointer-events","none")}},{key:"dragended",value:function(){this.dispatcher&&this.dispatcher.call("dragend",this.a,this.annotation),this.a.classed("dragging",!1),this.a.selectAll("circle.handle").style("pointer-events","all")}},{key:"dragSubject",value:function(){var t=this.annotation.position;t.x+=K.dx,t.y+=K.dy,this.annotation.position=t}},{key:"dragNote",value:function(){var t=this.annotation.offset;t.x+=K.dx,t.y+=K.dy,this.annotation.offset=t}},{key:"mapHandles",value:function(t){var n=this;return t.map((function(t){return wn({},t,{start:n.dragstarted.bind(n),end:n.dragended.bind(n)})}))}}]),t}(),Gn=function(t,n,e){return function(t){function i(t){mn(this,i);var e=jn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.typeSettings=n,n.disable&&n.disable.forEach((function(t){e[t]&&e[t].remove(),e[t]=void 0,"note"===t&&(e.noteContent=void 0)})),e}return Mn(i,t),bn(i,[{key:"className",value:function(){return""+(n.className||kn(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"className",this)&&kn(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"className",this).call(this)||"")}},{key:"drawSubject",value:function(t){return this.typeSettings.subject=wn({},n.subject,this.typeSettings.subject),kn(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"drawSubject",this).call(this,wn({},t,this.typeSettings.subject))}},{key:"drawConnector",value:function(t){return this.typeSettings.connector=wn({},n.connector,this.typeSettings.connector),kn(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"drawConnector",this).call(this,wn({},t,n.connector,this.typeSettings.connector))}},{key:"drawNote",value:function(t){return this.typeSettings.note=wn({},n.note,this.typeSettings.note),kn(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"drawNote",this).call(this,wn({},t,n.note,this.typeSettings.note))}},{key:"drawNoteContent",value:function(t){return kn(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"drawNoteContent",this).call(this,wn({},t,n.note,this.typeSettings.note))}}],[{key:"init",value:function(t,n){return kn(i.__proto__||Object.getPrototypeOf(i),"init",this).call(this,t,n),e&&(t=e(t,n)),t}}]),i}(t)},Jn=function(t){function n(t){mn(this,n);var e=jn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.textWrap=t.textWrap||120,e.drawText(),e}return Mn(n,t),bn(n,[{key:"updateTextWrap",value:function(t){this.textWrap=t,this.drawText()}},{key:"drawText",value:function(){if(this.note){Zn(this.note,[this.annotation],"g","annotation-note-content");var t=this.note.select("g.annotation-note-content");Zn(t,[this.annotation],"rect","annotation-note-bg"),Zn(t,[this.annotation],"text","annotation-note-label"),Zn(t,[this.annotation],"text","annotation-note-title");var n={height:0},e=this.a.select("text.annotation-note-label"),i=this.annotation.note&&this.annotation.note.wrap||this.typeSettings&&this.typeSettings.note&&this.typeSettings.note.wrap||this.textWrap,o=this.annotation.note&&this.annotation.note.wrapSplitter||this.typeSettings&&this.typeSettings.note&&this.typeSettings.note.wrapSplitter,a=this.annotation.note&&this.annotation.note.bgPadding||this.typeSettings&&this.typeSettings.note&&this.typeSettings.note.bgPadding,r={top:0,bottom:0,left:0,right:0};if("number"==typeof a?r={top:a,bottom:a,left:a,right:a}:a&&"object"===(void 0===a?"undefined":gn(a))&&(r=wn(r,a)),this.annotation.note.title){var s=this.a.select("text.annotation-note-title");s.text(this.annotation.note.title),s.attr("fill",this.annotation.color),s.attr("font-weight","bold"),s.call(ne,i,o),n=s.node().getBBox()}e.text(this.annotation.note.label).attr("dx","0"),e.call(ne,i,o),e.attr("y",1.1*n.height||0),e.attr("fill",this.annotation.color);var c=this.getNoteBBox();this.a.select("rect.annotation-note-bg").attr("width",c.width+r.left+r.right).attr("height",c.height+r.top+r.bottom).attr("x",c.x-r.left).attr("y",-r.top).attr("fill","white").attr("fill-opacity",0)}}}]),n}(Un),$n=(Gn(Jn,{className:"label",note:{align:"middle"}}),Gn(Jn,{className:"callout",note:{lineType:"horizontal"}})),Qn=(Gn($n,{className:"callout elbow",connector:{type:"elbow"}}),Gn($n,{className:"callout curve",connector:{type:"curve"}}),Gn(Un,{className:"badge",subject:{type:"badge"},disable:["connector","note"]}),Gn(Jn,{className:"callout circle",subject:{type:"circle"},note:{lineType:"horizontal"},connector:{type:"elbow"}})),Kn=(Gn(Jn,{className:"callout rect",subject:{type:"rect"},note:{lineType:"horizontal"},connector:{type:"elbow"}}),function(t){function n(){return mn(this,n),jn(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return Mn(n,t),bn(n,[{key:"mapY",value:function(t){kn(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"mapY",this).call(this,t);var e=this.annotation;(e.subject.x1||e.subject.x2)&&e.data&&t.y&&(e.y=t.y(e.data)),!e.subject.x1&&!e.subject.x2||e.x||(e.x=e.subject.x1||e.subject.x2)}},{key:"mapX",value:function(t){kn(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"mapX",this).call(this,t);var e=this.annotation;(e.subject.y1||e.subject.y2)&&e.data&&t.x&&(e.x=t.x(e.data)),!e.subject.y1&&!e.subject.y2||e.y||(e.y=e.subject.y1||e.subject.y2)}}]),n}($n)),Zn=(Gn(Kn,{className:"callout xythreshold",subject:{type:"threshold"}}),function(t,n,e,i,o){var a=t.selectAll(e+"."+(o||i)).data(n);return a.enter().append(e).merge(a).attr("class",i),a.exit().remove(),t}),te=function(t,n,e){var i=e.component,o=e.name;i&&i.on("mouseover.annotations",(function(){t.call(o+"over",i,n)})).on("mouseout.annotations",(function(){return t.call(o+"out",i,n)})).on("click.annotations",(function(){return t.call(o+"click",i,n)}))},ne=function(t,n,e){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.2;t.each((function(){for(var t=ut(this),o=t.text().split(e||/[ \t\r\n]+/).reverse().filter((function(t){return""!==t})),a=void 0,r=[],s=t.text(null).append("tspan").attr("x",0).attr("dy","0.8em");a=o.pop();)r.push(a),s.text(r.join(" ")),s.node().getComputedTextLength()>n&&r.length>1&&(r.pop(),s.text(r.join(" ")),r=[a],s=t.append("tspan").attr("x",0).attr("dy",i+"em").text(a))}))},ee=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:":not(.handle)";return t?t.selectAll(n).nodes().reduce((function(t,n){var e=n.getBBox();t.x=Math.min(t.x,e.x),t.y=Math.min(t.y,e.y),t.width=Math.max(t.width,e.width);var i=n&&n.attributes&&n.attributes.y;return t.height=Math.max(t.height,(i&&parseFloat(i.value)||0)+e.height),t}),{x:0,y:0,width:0,height:0}):{x:0,y:0,width:0,height:0}};function ie(){var t=[],n=void 0,e=void 0,i=[],o={},a={},r=!1,s=void 0,c=$n,h=void 0,u=void 0,l=kt("subjectover","subjectout","subjectclick","connectorover","connectorout","connectorclick","noteover","noteout","noteclick","dragend","dragstart"),f=void 0,p=function(e){f=e,r||e.selectAll("circle.handle").remove();var p=t.map((function(t){return t.type||(t.type=c),t.disable||(t.disable=i),new Nn(t)}));n=n||new Sn({annotations:p,accessors:o,accessorsInverse:a,ids:s}),e.selectAll("g").data([n]).enter().append("g").attr("class","annotations");var _=e.select("g.annotations");Zn(_,n.annotations,"g","annotation"),_.selectAll("g.annotation").each((function(t){var n=ut(this);n.attr("class","annotation"),Zn(n,[t],"g","annotation-connector"),Zn(n,[t],"g","annotation-subject"),Zn(n,[t],"g","annotation-note"),Zn(n.select("g.annotation-note"),[t],"g","annotation-note-content"),t.type="[object Object]"===t.type.toString()?t.type:new t.type({a:n,annotation:t,textWrap:h,notePadding:u,editMode:r,dispatcher:l,accessors:o}),t.type.draw(),t.type.drawText&&t.type.drawText()}))};return p.json=function(){return console.log("Annotations JSON was copied to your clipboard. Please note the annotation type is not JSON compatible. It appears in the objects array in the console, but not in the copied JSON.",n.json),window.copy(JSON.stringify(n.json.map((function(t){return delete t.type,t})))),p},p.update=function(){return t&&n&&(t=n.annotations.map((function(t){return t.type.draw(),t}))),p},p.updateText=function(){return n&&(n.updateText(h),t=n.annotations),p},p.updatedAccessors=function(){return n.setPositionWithAccessors(),t=n.annotations,p},p.disable=function(e){return arguments.length?(i=e,n&&(n.updateDisable(i),t=n.annotations),p):i},p.textWrap=function(e){return arguments.length?(h=e,n&&(n.updateTextWrap(h),t=n.annotations),p):h},p.notePadding=function(e){return arguments.length?(u=e,n&&(n.updateNotePadding(u),t=n.annotations),p):u},p.type=function(e,i){return arguments.length?(c=e,n&&(n.annotations.map((function(t){t.type.note&&t.type.note.selectAll("*:not(.annotation-note-content)").remove(),t.type.noteContent&&t.type.noteContent.selectAll("*").remove(),t.type.subject&&t.type.subject.selectAll("*").remove(),t.type.connector&&t.type.connector.selectAll("*").remove(),t.type.typeSettings={},t.type=c,t.subject=i&&i.subject||t.subject,t.connector=i&&i.connector||t.connector,t.note=i&&i.note||t.note})),t=n.annotations),p):c},p.annotations=function(e){if(!arguments.length)return n&&n.annotations||t;if(t=e,n&&n.annotations){var i=t.some((function(t){return!t.type||"[object Object]"!==t.type.toString()}));i?(n=null,p(f)):n.annotations=t}return p},p.context=function(t){return arguments.length?(e=t,p):e},p.accessors=function(t){return arguments.length?(o=t,p):o},p.accessorsInverse=function(t){return arguments.length?(a=t,p):a},p.ids=function(t){return arguments.length?(s=t,p):s},p.editMode=function(e){return arguments.length?(r=e,f&&f.selectAll("g.annotation").classed("editable",r),n&&(n.editMode(r),t=n.annotations),p):r},p.collection=function(t){return arguments.length?(n=t,p):n},p.on=function(){var t=l.on.apply(l,arguments);return t===l?p:t},p}}}]);